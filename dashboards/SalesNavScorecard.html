<!-- Qnèctra Sales Nav 30/60/90 Scorecard — v1 behavior (dropdowns) + dark page bg + brighter labels -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --page:#06070b;              /* NEW: dark page background */
    --bg:#0f1117;
    --card:rgba(255,255,255,.05);
    --card2:rgba(255,255,255,.03);
    --border:rgba(255,255,255,.10);
    --text:#f4f6ff;
    --muted:rgba(244,246,255,.74);
    --muted2:rgba(244,246,255,.62);
    --label:#e8ebff;             /* NEW: brighter label text */
    --label2:rgba(232,235,255,.86);
    --brand:#C12638;
    --green:#1F9C53;
    --amber:#DA8B00;
    --red:#C12638;
  }

  /* NEW: force the page background dark */
  html, body{
    background: var(--page) !important;
    margin:0;
  }

  .qsn-wrap{
    font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:var(--text);
    background:radial-gradient(circle at top left, #1a1a26 0%, #0b0b11 55%);
    border:1px solid var(--border);
    border-radius:18px;
    box-shadow:0 18px 44px rgba(0,0,0,.35);
    max-width:1080px;
    margin:22px auto;
    overflow:hidden;
  }

  .qsn-hdr{
    padding:18px 18px 14px;
    border-bottom:1px solid var(--border);
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:14px;
    background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));
  }
  .qsn-title{
    font-size:18px;
    font-weight:900;
    letter-spacing:.2px;
    margin:0;
  }
  .qsn-sub{
    margin-top:6px;
    font-size:12px;
    color:var(--muted);
    line-height:1.45;
    max-width:740px;
  }
  .qsn-actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    justify-content:flex-end;
  }
  .qsn-btn{
    appearance:none;
    border:1px solid var(--border);
    background:rgba(255,255,255,.06);
    color:var(--text);
    font-weight:800;
    font-size:12px;
    padding:10px 12px;
    border-radius:12px;
    cursor:pointer;
    user-select:none;
  }
  .qsn-btn.primary{
    background:var(--brand);
    border-color:rgba(255,255,255,.12);
  }
  .qsn-btn:hover{ filter:brightness(.96); }

  .qsn-body{
    padding:16px 18px 18px;
    background:rgba(0,0,0,.08);
  }

  .qsn-grid{
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
  }
  @media(min-width:980px){
    .qsn-grid{ grid-template-columns: 1.15fr .85fr; }
  }

  .qsn-card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:16px;
    padding:14px 14px 12px;
  }
  .qsn-card h3{
    margin:0 0 8px 0;
    font-size:13px;
    font-weight:900;
    letter-spacing:.08em;
    text-transform:uppercase;
    color:rgba(244,246,255,.86);
  }

  .qsn-tabs{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-bottom:10px;
  }
  .qsn-tab{
    border:1px solid var(--border);
    background:rgba(255,255,255,.05);
    color:var(--text);
    font-weight:900;
    font-size:12px;
    padding:9px 10px;
    border-radius:999px;
    cursor:pointer;
    opacity:.9;
  }
  .qsn-tab.active{
    background:rgba(193,38,56,.18);
    border-color:rgba(193,38,56,.55);
    opacity:1;
  }

  .qsn-kq{
    background:var(--card2);
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px;
    padding:12px;
    margin-bottom:12px;
  }
  .qsn-kq .k{ font-size:11px; color:var(--muted2); text-transform:uppercase; letter-spacing:.08em; font-weight:900; }
  .qsn-kq .q{ margin-top:6px; font-size:13px; line-height:1.45; font-weight:700; color:rgba(244,246,255,.94); }

  .qsn-table{
    width:100%;
    border-collapse:separate;
    border-spacing:0 10px;
  }
  .qsn-row{
    background:rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px;
    overflow:hidden;
  }
  .qsn-row td{
    padding:10px 10px;
    vertical-align:middle;
    font-size:12px;
    line-height:1.35;
  }

  /* NEW: brighter + more readable labels */
  .qsn-metric{
    font-weight:900;
    width:36%;
    color:var(--label);
  }
  .qsn-target{
    width:34%;
    color:var(--label2);
    font-weight:700;
  }
  .qsn-score{ width:30%; text-align:right; }

  /* Dropdown (original behavior) */
  .qsn-select{
    width:140px;
    padding:9px 10px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(0,0,0,.22);
    color:rgba(244,246,255,.92);
    font-weight:800;
    font-size:12px;
    outline:none;
    cursor:pointer;
  }
  .qsn-select option{ background:#0b0b11; color:#f4f6ff; }

  .qsn-notes{ margin-top:10px; }
  .qsn-notes textarea{
    width:100%;
    min-height:120px;
    resize:vertical;
    border-radius:14px;
    padding:10px 12px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    color:var(--text);
    font-size:12px;
    line-height:1.5;
    outline:none;
  }
  .qsn-mini{
    margin-top:8px;
    font-size:11px;
    color:var(--muted2);
    line-height:1.45;
  }

  .qsn-progress{
    margin-top:10px;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    padding:12px;
  }
  .qsn-progress .top{
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:center;
    margin-bottom:8px;
  }
  .qsn-progress .lbl{
    font-size:12px;
    font-weight:900;
    letter-spacing:.04em;
    text-transform:uppercase;
    color:rgba(244,246,255,.82);
  }
  .qsn-progress .val{
    font-size:12px;
    color:rgba(244,246,255,.86);
    font-weight:900;
  }
  .qsn-bar{
    height:10px;
    border-radius:999px;
    background:rgba(0,0,0,.28);
    border:1px solid rgba(255,255,255,.10);
    overflow:hidden;
  }
  .qsn-bar > div{
    height:100%;
    width:0%;
    background:var(--brand);
    transition:width .25s ease;
  }

  .qsn-summary{
    display:flex;
    flex-direction:column;
    gap:10px;
    margin-top:12px;
  }
  .qsn-srow{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    padding:10px 12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
  }
  .qsn-srow .k{
    font-size:12px;
    font-weight:900;
    letter-spacing:.04em;
    text-transform:uppercase;
    color:rgba(244,246,255,.78);
  }

  .qsn-badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 10px;
    border-radius:999px;
    border:1px solid var(--border);
    background:rgba(255,255,255,.05);
    font-size:12px;
    font-weight:900;
  }
  .qsn-dot{ width:10px; height:10px; border-radius:999px; background:rgba(255,255,255,.35); }
  .dot-green{ background:var(--green); }
  .dot-amber{ background:var(--amber); }
  .dot-red{ background:var(--red); }

  .qsn-decision{
    margin-top:10px;
    border-radius:16px;
    padding:14px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.05);
  }
  .qsn-decision h4{
    margin:0 0 6px 0;
    font-size:13px;
    font-weight:900;
    letter-spacing:.04em;
    text-transform:uppercase;
    color:rgba(244,246,255,.82);
  }
  .qsn-decision .p{
    margin:0;
    font-size:12px;
    line-height:1.55;
    color:rgba(244,246,255,.78);
  }

  .qsn-foot{
    padding:10px 18px 16px;
    font-size:11px;
    color:rgba(244,246,255,.55);
    border-top:1px solid rgba(255,255,255,.08);
    text-align:right;
  }
</style>

<div class="qsn-wrap" id="qsnScorecard">
  <div class="qsn-hdr">
    <div>
      <h2 class="qsn-title">Sales Navigator 30 / 60 / 90 Scorecard</h2>
      <div class="qsn-sub">
        Use this to validate your coaching ICP on LinkedIn and ensure your Sales Nav subscription compounds.
        Score each metric as Green, Yellow, or Red. Notes persist locally in your browser.
      </div>
    </div>
    <div class="qsn-actions">
      <button class="qsn-btn" id="qsnExport">Export Summary</button>
      <button class="qsn-btn" id="qsnReset">Reset</button>
      <button class="qsn-btn primary" id="qsnSave">Save</button>
    </div>
  </div>

  <div class="qsn-body">
    <div class="qsn-grid">
      <!-- LEFT -->
      <div class="qsn-left">
        <div class="qsn-card">
          <h3>Checkpoints</h3>

          <div class="qsn-tabs" role="tablist" aria-label="Scorecard checkpoints">
            <button class="qsn-tab active" data-tab="d30" role="tab" aria-selected="true">30 Days</button>
            <button class="qsn-tab" data-tab="d60" role="tab" aria-selected="false">60 Days</button>
            <button class="qsn-tab" data-tab="d90" role="tab" aria-selected="false">90 Days</button>
          </div>

          <!-- PANEL 30 -->
          <div class="qsn-panel" id="panel-d30">
            <div class="qsn-kq">
              <div class="k">Key question at 30 days</div>
              <div class="q">Do I clearly recognize who belongs — and who doesn’t?</div>
            </div>

            <table class="qsn-table">
              <tr class="qsn-row">
                <td class="qsn-metric">Profiles reviewed</td>
                <td class="qsn-target">100–150</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d30_profiles"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Qualified leads saved</td>
                <td class="qsn-target">30–50</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d30_saved"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">False positives trend</td>
                <td class="qsn-target">Decreasing week-over-week</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d30_fp"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Distinct patterns identified</td>
                <td class="qsn-target">≥5</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d30_patterns"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">ICP confidence</td>
                <td class="qsn-target">Medium+ (can describe a real buyer)</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d30_icp"></select></td>
              </tr>
            </table>

            <div class="qsn-notes">
              <textarea data-k="d30_notes" placeholder="30-day notes (patterns, surprises, what changed this month)…"></textarea>
              <div class="qsn-mini">Operator note: At 30 days, clarity matters more than outreach. If it still feels random, refine lists + filters.</div>
            </div>
          </div>

          <!-- PANEL 60 -->
          <div class="qsn-panel" id="panel-d60" style="display:none;">
            <div class="qsn-kq">
              <div class="k">Key question at 60 days</div>
              <div class="q">Can I segment this market into subtypes I understand?</div>
            </div>

            <table class="qsn-table">
              <tr class="qsn-row">
                <td class="qsn-metric">Profiles reviewed (cumulative)</td>
                <td class="qsn-target">250–300</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d60_profiles"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Qualified leads saved (cumulative)</td>
                <td class="qsn-target">60–80</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d60_saved"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Distinct ICP subtypes</td>
                <td class="qsn-target">3–4</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d60_subtypes"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Strong-signal lists</td>
                <td class="qsn-target">≥2 lists produce good leads reliably</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d60_lists"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Messaging readiness</td>
                <td class="qsn-target">High (you know what to lead with)</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d60_msg"></select></td>
              </tr>
            </table>

            <div class="qsn-notes">
              <textarea data-k="d60_notes" placeholder="60-day notes (subtypes emerging, which lists work, key disqualifiers)…"></textarea>
              <div class="qsn-mini">Operator note: At 60 days, you should be able to say “we serve these subtypes best” and exclude the rest.</div>
            </div>
          </div>

          <!-- PANEL 90 -->
          <div class="qsn-panel" id="panel-d90" style="display:none;">
            <div class="qsn-kq">
              <div class="k">Key question at 90 days</div>
              <div class="q">Is this a niche I can consistently reach, qualify, and engage on LinkedIn?</div>
            </div>

            <table class="qsn-table">
              <tr class="qsn-row">
                <td class="qsn-metric">Profiles reviewed (cumulative)</td>
                <td class="qsn-target">400–500</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d90_profiles"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Clean lead bench</td>
                <td class="qsn-target">100–150 outreach-ready leads</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d90_bench"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Outreach confidence</td>
                <td class="qsn-target">High (who + why is obvious)</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d90_conf"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Credit efficiency</td>
                <td class="qsn-target">Low waste; credits tied to objectives</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d90_credits"></select></td>
              </tr>
              <tr class="qsn-row">
                <td class="qsn-metric">Channel clarity</td>
                <td class="qsn-target">LinkedIn is viable primary channel</td>
                <td class="qsn-score"><select class="qsn-select" data-k="d90_channel"></select></td>
              </tr>
            </table>

            <div class="qsn-notes">
              <textarea data-k="d90_notes" placeholder="90-day notes (commit / hybrid / exit decision rationale)…"></textarea>
              <div class="qsn-mini">Operator note: At 90 days, you should know exactly who to message and why. If not, pause or exit the channel.</div>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT -->
      <div class="qsn-right">
        <div class="qsn-card">
          <h3>Rollup</h3>

          <div class="qsn-progress">
            <div class="top">
              <div class="lbl">Overall completion</div>
              <div class="val" id="qsnCompletion">0%</div>
            </div>
            <div class="qsn-bar"><div id="qsnBar"></div></div>
            <div class="qsn-mini" style="margin-top:10px;">
              Completion measures whether you’ve scored each metric (not whether it’s green).
            </div>
          </div>

          <div class="qsn-summary">
            <div class="qsn-srow">
              <div class="k">30-Day Status</div>
              <div class="v" id="status30"><span class="qsn-badge"><span class="qsn-dot"></span> Not scored</span></div>
            </div>
            <div class="qsn-srow">
              <div class="k">60-Day Status</div>
              <div class="v" id="status60"><span class="qsn-badge"><span class="qsn-dot"></span> Not scored</span></div>
            </div>
            <div class="qsn-srow">
              <div class="k">90-Day Status</div>
              <div class="v" id="status90"><span class="qsn-badge"><span class="qsn-dot"></span> Not scored</span></div>
            </div>
          </div>

          <div class="qsn-decision" id="qsnDecisionBox">
            <h4>Decision Guidance</h4>
            <p class="p" id="qsnDecisionText">
              Score the checkpoints, then review the rollup. Use this as a “clarity meter,” not a vanity score.
            </p>
          </div>

          <div class="qsn-mini" style="margin-top:10px;">
            Scoring: <b>Green</b> = repeatable, improving • <b>Yellow</b> = some signal, refine • <b>Red</b> = unclear/noisy
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="qsn-foot">Internal scorecard • Qnèctra HQ • Signal &gt; Activity</div>
</div>

<script>
(function(){
  const STORE_KEY = "qnectra_salesnav_306090_scorecard_v1_dark";
  const root = document.getElementById("qsnScorecard");

  const tabs = Array.from(root.querySelectorAll(".qsn-tab"));
  const panels = {
    d30: root.querySelector("#panel-d30"),
    d60: root.querySelector("#panel-d60"),
    d90: root.querySelector("#panel-d90"),
  };

  const bar = root.querySelector("#qsnBar");
  const completionEl = root.querySelector("#qsnCompletion");
  const status30 = root.querySelector("#status30");
  const status60 = root.querySelector("#status60");
  const status90 = root.querySelector("#status90");
  const decisionText = root.querySelector("#qsnDecisionText");
  const decisionBox = root.querySelector("#qsnDecisionBox");

  const GREEN="#1F9C53", AMBER="#DA8B00", RED="#C12638";

  function setActiveTab(tabKey){
    tabs.forEach(t => {
      const active = t.dataset.tab === tabKey;
      t.classList.toggle("active", active);
      t.setAttribute("aria-selected", active ? "true" : "false");
    });
    Object.keys(panels).forEach(k => panels[k].style.display = (k === tabKey) ? "block" : "none");
  }
  tabs.forEach(t => t.addEventListener("click", () => setActiveTab(t.dataset.tab)));

  function populateSelects(){
    const selects = Array.from(root.querySelectorAll("select.qsn-select"));
    selects.forEach(sel=>{
      if(sel.options.length) return;
      sel.innerHTML = `
        <option value="">Select…</option>
        <option value="green">Green</option>
        <option value="amber">Yellow</option>
        <option value="red">Red</option>
      `;
    });
  }

  function badge(state){
    if(state === "green") return `<span class="qsn-badge"><span class="qsn-dot dot-green"></span> Green</span>`;
    if(state === "amber") return `<span class="qsn-badge"><span class="qsn-dot dot-amber"></span> Yellow</span>`;
    if(state === "red") return `<span class="qsn-badge"><span class="qsn-dot dot-red"></span> Red</span>`;
    return `<span class="qsn-badge"><span class="qsn-dot"></span> Not scored</span>`;
  }

  function checkpointStatus(prefix){
    const vals = Array.from(root.querySelectorAll(`select[data-k^="${prefix}"]`))
      .map(el => el.value)
      .filter(Boolean);

    if(vals.length === 0) return "";

    const greens = vals.filter(v => v === "green").length;
    const ambers = vals.filter(v => v === "amber").length;
    const reds   = vals.filter(v => v === "red").length;

    if(reds > 0 && reds >= greens) return "red";
    if(greens >= 3 && greens > ambers && greens >= reds) return "green";
    return "amber";
  }

  function computeCompletion(){
    const selects = Array.from(root.querySelectorAll("select.qsn-select"));
    const notes = Array.from(root.querySelectorAll("textarea[data-k]"));
    const total = selects.length + notes.length;
    const filled = selects.filter(s => s.value).length + notes.filter(t => t.value.trim().length > 0).length;
    const pct = total ? Math.round((filled/total)*100) : 0;
    completionEl.textContent = pct + "%";
    bar.style.width = pct + "%";
  }

  function refreshDecision(){
    const s30 = checkpointStatus("d30_");
    const s60 = checkpointStatus("d60_");
    const s90 = checkpointStatus("d90_");

    status30.innerHTML = badge(s30);
    status60.innerHTML = badge(s60);
    status90.innerHTML = badge(s90);

    const latest = s90 || s60 || s30 || "";

    decisionBox.style.borderColor = "rgba(255,255,255,.12)";
    decisionBox.style.background = "rgba(255,255,255,.05)";

    if(!latest){
      decisionText.textContent = "Score the checkpoints, then review the rollup. Use this as a “clarity meter,” not a vanity score.";
      return;
    }
    if(latest === "green"){
      decisionBox.style.borderColor = "rgba(31,156,83,.45)";
      decisionBox.style.background = "rgba(31,156,83,.14)";
      decisionText.textContent = "Mostly GREEN: keep the cadence, double down on the strongest lists, and begin planning intentional outreach triggers.";
      return;
    }
    if(latest === "amber"){
      decisionBox.style.borderColor = "rgba(218,139,0,.45)";
      decisionBox.style.background = "rgba(218,139,0,.14)";
      decisionText.textContent = "Mostly YELLOW: signal exists, but refine filters/lists and tighten disqualifiers. Focus on clarity, not volume.";
      return;
    }
    if(latest === "red"){
      decisionBox.style.borderColor = "rgba(193,38,56,.55)";
      decisionBox.style.background = "rgba(193,38,56,.14)";
      decisionText.textContent = "RED present: pause outreach. Reassess ICP assumptions, list design, and where false positives come from before continuing.";
      return;
    }
  }

  function save(){
    const data = {};
    Array.from(root.querySelectorAll("select.qsn-select")).forEach(s=>{
      data[s.getAttribute("data-k")] = s.value || "";
    });
    Array.from(root.querySelectorAll("textarea[data-k]")).forEach(t=>{
      data[t.getAttribute("data-k")] = t.value || "";
    });
    localStorage.setItem(STORE_KEY, JSON.stringify(data));
    refresh();
  }

  function load(){
    try{
      const raw = localStorage.getItem(STORE_KEY);
      if(!raw) return;
      const data = JSON.parse(raw);

      Array.from(root.querySelectorAll("select.qsn-select")).forEach(s=>{
        const k = s.getAttribute("data-k");
        if(k in data) s.value = data[k] || "";
      });
      Array.from(root.querySelectorAll("textarea[data-k]")).forEach(t=>{
        const k = t.getAttribute("data-k");
        if(k in data) t.value = data[k] || "";
      });
    }catch(e){}
  }

  function resetAll(){
    if(!confirm("Reset all scores and notes for this scorecard?")) return;
    localStorage.removeItem(STORE_KEY);
    Array.from(root.querySelectorAll("select.qsn-select")).forEach(s=>s.value="");
    Array.from(root.querySelectorAll("textarea[data-k]")).forEach(t=>t.value="");
    refresh();
  }

  function exportSummary(){
    const data = {};
    Array.from(root.querySelectorAll("select.qsn-select")).forEach(s=>{
      data[s.getAttribute("data-k")] = s.value || "";
    });
    Array.from(root.querySelectorAll("textarea[data-k]")).forEach(t=>{
      data[t.getAttribute("data-k")] = t.value || "";
    });

    const summarize = (prefix) => {
      const keys = Object.keys(data).filter(k => k.startsWith(prefix) && !k.endsWith("_notes"));
      const notesKey = prefix + "notes";
      const notesText = (data[notesKey] || "").trim();
      const counts = { green:0, amber:0, red:0, blank:0 };
      keys.forEach(k=>{
        const v = data[k];
        if(v === "green") counts.green++;
        else if(v === "amber") counts.amber++;
        else if(v === "red") counts.red++;
        else counts.blank++;
      });
      return { counts, notes: notesText };
    };

    const s30 = summarize("d30_");
    const s60 = summarize("d60_");
    const s90 = summarize("d90_");

    const out =
`Qnèctra Sales Nav 30/60/90 Scorecard Summary

30 Days: Green ${s30.counts.green} • Yellow ${s30.counts.amber} • Red ${s30.counts.red} • Unscored ${s30.counts.blank}
Notes: ${s30.notes || "(none)"}

60 Days: Green ${s60.counts.green} • Yellow ${s60.counts.amber} • Red ${s60.counts.red} • Unscored ${s60.counts.blank}
Notes: ${s60.notes || "(none)"}

90 Days: Green ${s90.counts.green} • Yellow ${s90.counts.amber} • Red ${s90.counts.red} • Unscored ${s90.counts.blank}
Notes: ${s90.notes || "(none)"}
`;

    navigator.clipboard.writeText(out).then(() => {
      const btn = root.querySelector("#qsnExport");
      const prev = btn.textContent;
      btn.textContent = "Exported ✓";
      setTimeout(()=>btn.textContent = prev, 1200);
    }).catch(()=> alert("Copy failed. Your browser may block clipboard access in this context."));
  }

  function refresh(){
    computeCompletion();
    refreshDecision();
  }

  // Wire events (original dropdown behavior)
  function wire(){
    Array.from(root.querySelectorAll("select.qsn-select")).forEach(s=>{
      s.addEventListener("change", ()=>{
        // tiny auto-save debounce
        if(wire._t) clearTimeout(wire._t);
        wire._t = setTimeout(save, 150);
      });
    });
    Array.from(root.querySelectorAll("textarea[data-k]")).forEach(t=>{
      t.addEventListener("input", ()=>{
        if(wire._t2) clearTimeout(wire._t2);
        wire._t2 = setTimeout(save, 300);
      });
    });

    root.querySelector("#qsnSave").addEventListener("click", () => {
      save();
      const btn = root.querySelector("#qsnSave");
      const prev = btn.textContent;
      btn.textContent = "Saved ✓";
      setTimeout(()=>btn.textContent = prev, 1200);
    });
    root.querySelector("#qsnReset").addEventListener("click", resetAll);
    root.querySelector("#qsnExport").addEventListener("click", exportSummary);
  }

  // init
  populateSelects();
  load();
  wire();
  refresh();
  setActiveTab("d30");
})();
</script>

