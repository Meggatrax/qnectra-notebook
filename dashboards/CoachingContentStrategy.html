<!--
PATCH: “Done” feature for the 12-week strategy HTML.
✅ Adds a Done checkbox per week
✅ Persists state in localStorage
✅ Turns the Week badge + row shading green when Done

How to use:
1) Add the CSS block below to your <style> section.
2) Replace your existing <details> blocks with the updated pattern (or copy the “details template” and apply to each week).
3) Add the JS block below to your <script> section (near the bottom).
-->

<!-- 1) ADD THIS CSS (append to your existing <style>) -->
<style>
  /* Done state styling */
  details.done{
    border-color: rgba(52,211,153,0.35) !important;
    background: rgba(52,211,153,0.06) !important;
  }
  details.done summary{
    background: rgba(52,211,153,0.06);
  }
  details.done .week{
    border-color: rgba(52,211,153,0.55) !important;
    background: rgba(52,211,153,0.18) !important;
    color: rgba(255,255,255,0.92) !important;
  }

  /* Small Done control in the summary row */
  .doneControl{
    display:flex;
    align-items:center;
    gap:8px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.05);
    color: rgba(255,255,255,0.75);
    font-size: 11px;
    white-space: nowrap;
  }
  .doneControl input[type="checkbox"]{
    width: 14px;
    height: 14px;
    accent-color: #34d399; /* green */
    cursor: pointer;
  }
  .doneControl .label{
    user-select:none;
  }

  /* Keep caret aligned when adding doneControl */
  .sumRight{
    display:flex;
    align-items:center;
    gap:10px;
  }
</style>

<!-- 2) UPDATE EACH <details> LIKE THIS (example for Week 1)
     IMPORTANT: add data-week-id="week-01" (unique per week) -->
<details data-week-id="week-01" data-month="m1" data-pillar="cx" data-keywords="onboarding first 7 days experience promise retention">
  <summary>
    <div class="sumLeft">
      <div class="week">Week 1</div>
      <div class="sumText">
        <p class="sumTitle">Your onboarding is part of your offer.</p>
        <p class="sumMeta">Month 1 · Client Experience Ops</p>
      </div>
    </div>

    <div class="sumRight">
      <label class="doneControl" title="Mark this week as done">
        <input class="doneToggle" type="checkbox" />
        <span class="label">Done</span>
      </label>
      <div class="caret">▾</div>
    </div>
  </summary>

  <div class="content">
    <!-- your existing Week 1 content stays exactly the same -->
  </div>
</details>

<!-- Repeat for Week 2..12, changing data-week-id to:
     week-02, week-03, ... week-12 -->

<!-- 3) ADD THIS JS (append near the bottom of your existing <script>) -->
<script>
  // DONE FEATURE: persist Done state per week and apply green styling
  (function initDoneFeature(){
    const STORAGE_KEY = "qnectra_coaching_content_plan_done_v1";

    function loadState(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); }
      catch(e){ return {}; }
    }
    function saveState(state){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    const state = loadState();
    const weeksRoot = document.getElementById("weeks");
    if (!weeksRoot) return;

    const detailNodes = weeksRoot.querySelectorAll("details[data-week-id]");
    detailNodes.forEach(d => {
      const id = d.dataset.weekId;
      const checkbox = d.querySelector(".doneToggle");
      if (!id || !checkbox) return;

      // Initialize from saved state
      const isDone = !!state[id];
      checkbox.checked = isDone;
      d.classList.toggle("done", isDone);

      // Prevent clicking checkbox from toggling the details open/closed
      checkbox.addEventListener("click", (e) => e.stopPropagation());
      checkbox.addEventListener("mousedown", (e) => e.stopPropagation());

      checkbox.addEventListener("change", () => {
        const doneNow = checkbox.checked;
        state[id] = doneNow;
        saveState(state);
        d.classList.toggle("done", doneNow);
      });
    });
  })();
</script>
